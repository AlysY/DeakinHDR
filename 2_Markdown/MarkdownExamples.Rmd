---
title: "Markdown Examples"
author: "Orginially Billy Geary, updated by Alys Young"
date: "`r format(Sys.time(), '%d %B %Y)`"
output:
  html_document:
    toc: true
    toc_depth: 2
    number_sections: true
---

### notes for a new tutorial:

- italics on an output of inline code using kableExtra and text_spec
```{r setup, include=FALSE}
library(tidyr)
library(dplyr)
data(cars) # Load example dataset
```

# R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.
<br>
When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can knit to either a pdf or html. 
<br>

# Text

Use hashes before text to specifiy headings.
# Big heading
## Little heading
### Even littler heading
#### Even littler again heading

* dot points use a single star or plus sign.
  * sub points are added by using a tab before the symbol
  * note, dot points need to have a spare line before them
  
1. Numbered lists do not need to have a spare line beforethem
2. Type the number, then a full stop, then a space to create a numbered list
3. like this one!

You can also **Bold** , *Italicise* or ~stikethrough~ your text. Bold uses two ** or __ where as italics uses one * or _ and strikethrough uses ~ .

Embed equations using the dollar signs.

$$y = mx + c$$
Including adding greek letters, superscripts or subscripts
$$log(\mu) = \beta_0 + \beta_1 * elev$$
You can format text to look like code by using a single backtick around the code words, like `cars` is the name of the dataset. You can use inline code by using three backticks, like to find out that the mean speed recorded in the cars dataset is ```mean(cars$speed)``` .

Add the symbols "<br>" will add a break.
<br>

Three * stars together will create a horizontal line to break the document. 

***

# Chunk options

Use a chunk name, but this must be unique.

When `include = FALSE` is included, the results and code are not included in the report. The code is run and the results can be used.
When `echo = FALSE`, the code is hidden but the results are shown.
When `eval = FALSE`, the code will not run but the code will be shown.
When `collapse = TRUE`, the code and the output text will be shown in the same box.
When `warning = FALSE`, prevents warning messages from appearing entirely.
When `error = TRUE`, the report will knit but the error will be displayed. Apply this globally.

# The YAML header
YAML is very specific with its layout and number of spaces or tabs.

Some basic components are:

- `title`: "This is the page title"
- `author`: "Author's name goes here"
- `date`: this could be a character string by typing the date out manually, or you could use "`r format(Sys.time(), '%d %B %Y)`" to get today's date
- `output`: there are a few common formats including html and pdf.
- within the output component, you could specify to use a table of content using `toc` or number the sections using `number_sections`. For a html output, the table of content can sit on the side of the page using `toc_float: true`. `toc_float` also has a smooth scroll and collapsed options.
output:
  html_document:
    toc: true
    toc_depth: 2
    number_sections: true

# Using R Markdown to show results straight from R

(or, no more copying and pasting!)

## Looking at some data
```{r cars, message=FALSE, warning=FALSE}
data(cars) # Load example dataset
head(cars)
summary(cars)
```


## Cool tables using kable
```{r message=FALSE, warning=FALSE}
library(knitr)
# Create mini table of summary statistics
summary.stats = cars %>% group_by() %>% summarise(Mean_Speed = mean(speed),
                                                  SD_Speed = sd(speed),
                                                  Mean_Dist = mean(dist),
                                                  SD_Dist = sd(dist))
summary.stats
```

Now make a pretty table
```{r}
kable(summary.stats)
```

## A really good use: model coefficient tables
```{r message=FALSE, warning=FALSE}
m = lm(dist ~ speed, data=cars)
coeffs = data.frame(coef(m))
conf = data.frame(confint(m))

model.table = cbind(coeffs, conf)
# colnames(model.table) = c("Coef", "Lower 95% CI", "Upper 95% CI")

kable(model.table,
      col.names =  c("Coef", "Lower 95% CI", "Upper 95% CI"),
      align = c("ccc"), # where alignment is defined using a single letter. l for left, c for centre and r for right, and one letter for each column
      caption = "1.2 Model coefficients table.") 
```

## Embedding plots using ggplot
```{r message=FALSE, warning=FALSE}
library(ggplot2)
# Standard ggplot 
cars.re = cars %>% pivot_longer(cols=c(speed,dist), names_to='name', values_to='value')

boxplot = ggplot(cars.re) + geom_boxplot(aes(x=name,y=value))
boxplot

plot = ggplot(cars, aes(x = speed, y = dist)) + geom_point() + geom_smooth() + theme_bw()
plot
```

We can also add the specifics of how to format the plot into the chunk header. Here I have included `fig.align` to centre the figure (other options are left and right), set the width and height using `fig.width` and `fig.height` in inches, and added a figure caption using `fig.cap`. Other options for the plot size would be to use `out.width` and `out.height` which are specified as percentages and in quotation marks.

```{r message=FALSE, warning=FALSE, fig.align="center", fig.width=6, fig.height=6, fig.cap="Figure: Here is a really important caption."}
ggplot(cars, aes(x = speed, y = dist)) + geom_point() + geom_smooth() + theme_bw()
```

## Side by side plots with cowplot
```{r message=FALSE, warning=FALSE}
cowplot::plot_grid(plot, boxplot, labels=c("a)", "b)"))
```


## Interactive plots with plotly
If you save your markdown file as an HTML file, you can also embed interactive plots by converting ggplot plots to plotly plots

```{r message=FALSE, warning=FALSE}
library(plotly)
# Converting to an interactive plot with plotly
ggplotly(plot)
```

## Embedding interactive maps

```{r message=FALSE, warning=FALSE}
library(leaflet)
library(sf)

vic = read_sf("~/Dropbox/_Research/data/spatial/outline_shapefiles/Vic Outline/vmlite_victoria_line_su2.shp")

plot(vic$geometry) # Check the data

```

Now do the interactive map

```{r message=FALSE, warning=FALSE}
#
map = leaflet(vic) %>% 
  addTiles() %>% # default basemap
  addPolylines() # add the shapefle (Vic Outline)

map

```

## Can do the same with raster data
```{r message=FALSE, warning=FALSE}
library(raster)

ras = raster("~/Dropbox/_Research/data/spatial/climate grids/rainfall_means/July_MeanRainfall.grid")
crs(ras) = "+proj=longlat +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +no_defs"
ras = projectRaster(ras, crs = '+proj=longlat +datum=WGS84')

raster.map = leaflet(ras) %>%
  addTiles() %>%
  addRasterImage(ras$July_MeanRainfall)

raster.map

```


## Some good examples to steal ideas from

* Scroggie et al. 2020 Journal of Applied Ecology (https://besjournals.onlinelibrary.wiley.com/doi/abs/10.1111/1365-2664.13253)
* Lamb et al. 2020 PNAS (https://www.pnas.org/content/117/30/17876)
